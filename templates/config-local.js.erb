// FILE MANAGED BY PUPPET, CHANGES WILL BE OVERWRITTEN
module.exports = {
    settings: {
        // MongoDB database url
        // default = 'mongodb://localhost/svmp_proxy_db'
        db: 'mongodb://<%= @db_host %>/<%= db_name %>',

        // External TCP port to listen on for client connections.
        // default = 8002
        port: <%= @server_port %>,

        // Port to connect to on Android VMs
        // default = 8001
        vm_port: <%= @vm_port %>,

        // Enable SSL
        // default = false
        tls_proxy: <%= @use_ssl %>,

        // SSL certificate and private key paths
        // (required if tls_proxy == true)
        tls_certificate: '<%= @tls_cert %>',
        tls_private_key: '<%= @tls_private_key %>',

        // SSL private key password
        // (if the server private key file is password protected)
        tls_private_key_pass: '<%= @tls_key_pass %>',

        // Use TLS client authentication
        // default = false
        use_tls_user_auth: <%= @tls_user_auth %>,

        // TLS CA Cert to validate user certs against
        // only used if use_tls_user_auth == true
        tls_ca_cert: '<%= @tls_ca_cert %>',

        // Maximum length of a client session (in seconds) before it is
        // forcibly disconnected.
        // default = 21600 [6 hours]
        max_session_length: <%= @session_max_length %>,

        // Validity time of session tokens in seconds.
        // Allows client to reconnect a disconnected session by providing
        // the token instead of doing a full re-authentication.
        // default = 120 [2 minutes]
        session_token_ttl: <%= @session_token_ttl %>,

        // Interval (in seconds) of time to check for expired sessions.
        // This is used while a connection is active.
        // default = 60 [1 minute]
        session_check_interval: <%= @session_check_interval %>,

        // Maximum life span of an idle VM (in seconds) before it is expired and gets destroyed.
        // This is used after a session is disconnected.
        // default = 3600 [1 hour]
        vm_idle_ttl: <%= @vm_idle_ttl %>,

        // Interval (in seconds) of time to check for expired VMs.
        // This is used after a session is disconnected.
        // default = 300 [5 minutes]
        vm_check_interval: <%= @vm_idle_check_interval %>,

        // Use PAM authentication
        // default = false
        use_pam: <%= @use_pam %>,

        // PAM 'service' name to use. I.e., which file under /etc/pam.d/
        // default = 'svmp'
        pam_service: '<%= @pam_service %>',

        // Log file path
        // default = 'proxy_log.txt'
        log_file: '<%= @log_file %>',

        // Log level to use, omits lower log levels
        // Levels, lowest to highest: silly, debug, verbose, info, warn, error
        // default = 'info'
        log_level: '<%= @log_level %>',

        // Protobuf request messages to filter out when using verbose logging
        // default = ['SENSOREVENT', 'TOUCHEVENT']
        log_request_filter: [ <% @log_filter.each do |val| %>
                                  '<%= val %>',
                              <% end %>
                            ],

        // Openstack cloud connection details
        openstack: {
            "authUrl": "<%= @cloud_auth_url %>",
            "username": "<%= @cloud_username %>",
            "password": "<%= @cloud_password %>",
            "tenantId": "<%= @cloud_tenant_id %>",
            "tenantName": "<%= @cloud_tenant_name %>",
            "region": "<%= @cloud_region %>"
        },

        // VM/Volume defaults
        // images: a map of device types to their respective image ids on the Openstack server.
        // vmflavor: the number value (as a string) of the VM flavor. Ex: m1.tiny = '1', m1.small = '2'  See Openstack
        //   for available values for your setup. Or run bin/spm image for a listing. Note: GUID values won't work.
        // goldsnapshotId: the snapshot id to use for new volumes
        // goldsnapshotSize: the integer size in GBs. THIS SHOULD BE SAME AS THE goldsnapshot SIZE
        // use_floating_ip: if this is enabled, we assign a floating IP address to the VM when we start it. This is
        //   necessary if the proxy server isn't running within Openstack itself.
        // floating_ip_pool: if use_floating_ip is enabled, this can be optionally specified to tell Openstack what
        //   ip pool to use when allocating new addresses
        // pollintervalforstartup: this is the interval in milliseconds the apis to check for a running VM

        new_vm_defaults: {
            "images": {
                // each device type should have its own name and image ID in key/value format, e.g.:
                // "device_type": "imageID",
                "default": "<%= @cloud_vm_gold_image_id %>",
            },
            vmflavor: "<%= @cloud_vm_flavor %>",
            goldsnapshotId: "<%= @cloud_master_data_volume_id %>",
            goldsnapshotSize: <%= @cloud_master_data_volume_size %>,
            use_floating_ips: <%= @cloud_use_floating_ips %>,
            floating_ip_pool: "<%= @cloud_floating_ip_pool %>",
            pollintervalforstartup: 2000
        }
    },

    // WebRTC Video Information sent from Proxy to Client
    webrtc: {
        ice: { 
            iceServers: [ <% @ice_servers.each do |val| %>
                          {url: '<%= val %>'},
                          <% end %>
                        ]},
        video: { audio: true, 
                 video: { mandatory: {}, optional: [] } 
               },
        pc: { optional: [ { DtlsSrtpKeyAgreement: true } ] }
    }
};
